#!/bin/sh

set -e

usage() {
  cat <<'EOF'
Usage:

  puavo-admin-remote-connections --accept-incoming
                                 --is-incoming-accepted
                                 --reject-incoming
                                 --show-enable-time

  Give one of "--accept-incoming", "--is-incoming-accepted",
  "--reject-incoming" or "--show-enable-time" options.
  If connections are accepted, "--is-incoming-accepted"
  prints "yes" to standard output, and "no" if those are rejected.
EOF
}

action=$1

set -u

config_file_path="/var/lib/puavo-desktop/shared/puavo-admin-remote-connections.conf"

case "$action" in
  --accept-incoming)
    touch "$config_file_path"
    ;;
  -h|--help)
    usage
    exit 0
    ;;
  --is-incoming-accepted)
    if [ -e "$config_file_path" ]; then
      echo yes
    else
      echo no
    fi
    ;;
  --reject-incoming)
    rm -f "$config_file_path"
    ;;
  --show-enable-time)
    # if this fails, then we simply fail with an error
    stat -c %Y "$config_file_path" 2>/dev/null
    ;;
  *)
    usage >&2
    exit 1
    ;;
esac
