# Generate dconf profile based on locale and host type.
#

puavo_user_desktopconf_path="/var/lib/puavo-desktop/users/${USER}"
puavo_dconf_profile_path="${puavo_user_desktopconf_path}/dconf_profile"

{
  echo "user-db:user"

  if [ -n "$LANGUAGE" ]; then
    echo "system-db:locale-$LANGUAGE"
  else
    echo "system-db:locale-en"
  fi

  PUAVO_HOSTTYPE=$(cat /etc/puavo/hosttype)
  case "$PUAVO_HOSTTYPE" in
    laptop)
      echo "system-db:laptop"
      ;;
  esac

  # If there are xrandr settings from puavo, turn off the gnome-settings-daemon
  # xrandr plugin.
  puavo_xrandr_settings=$(jq -r .device.xrandr "$PUAVO_SESSION_PATH" || true)
  if [ "$puavo_xrandr_settings" != "null" \
       -a "$puavo_xrandr_settings" != "[]" \
       -a "$puavo_xrandr_settings" != "" ]; then
    echo "system-db:turn_off_xrandrplugin"
  fi

  echo "system-db:keyboard"
  echo "system-db:puavodesktop"
} > $puavo_dconf_profile_path || return 1

DCONF_PROFILE=$puavo_dconf_profile_path

export DCONF_PROFILE
